<!-- 
    based off of tutorials by Mike Mulshine et al
    dependencies are in https://ccrma.stanford.edu/~cc/220a/webchuck220a/
-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<!--- make responsive for mobile devices -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
<!--- Include the ACE editor and webchuck stuff -->
  <link rel="stylesheet" href="https://ccrma.stanford.edu/~cc/220a/webchuck220a/css/editor.css">
  <script type="text/javascript" src="https://ccrma.stanford.edu/~cc/220a/webchuck220a/js/ace.js" charset="utf-8"></script>
  <script type="text/javascript" src="https://ccrma.stanford.edu/~cc/220a/webchuck220a/js/editor.js"></script>
  <script type="text/javascript" src="https://ccrma.stanford.edu/~cc/220a/webchuck220a/js/defer.js"></script>
  <script type="text/javascript" src="https://ccrma.stanford.edu/~cc/220a/webchuck220a/js/webchuck_host.js"></script>

</head>

<p>Polyphonic clips demo.
</p>

<h2> HW2 </h2>
<p>Here the parent shred starts a sequence of clips by sporking them at particular times. <br>To see the print
statements from the live code, open the browser web developer tools and go to the console (Firefox: F12, meaning "function 12")<br>Set the console output filter to only print output from "Logs". </p>

//////////////////////////////////////////////////// <br>
suggestions (copy and replace any of these items in live code) <br>   
<pre><div id="editor2" class="ace_editor ace_hidpi ace-chuck">
</div></pre>
//////////////////////////////////////////////////// <br>
live code
<pre><div id="editor1" class="ace_editor ace_hidpi ace-chuck">  
// parent starts a sequence of clips by sporking them at particular times
now => time t0;

spork ~childClip1(5::second, t0); // global time = 0 sec
1::second => now;
spork ~childClip2(5::second, t0); // global time = 1 sec
5::second => now;
spork ~childClip1(1::second, t0); // global time = 6 sec
1::second => now;

now => time t1; // global time = 7 sec

// parent program will end with this print statement
<<<"parent lasted for",(t1-t0)/second,"seconds">>>;
// and with nothing left to do this program exits 

//////////////////////////////////////////////////
// here are the function definitions, they can appear later in the document

// define a "clip" as a function
fun void childClip1(dur myDur, time t0) {
  <<<"a childClip1 starting at",(now-t0)/second,"is playing for",myDur/second,"seconds">>>;
  myDur => now;
  <<<"a childClip1 stopped at time",(now-t0)/second>>>;
}

// define another "clip"
fun void childClip2(dur myDur, time t0) {
  <<<"a childClip2 starting at",(now-t0)/second,"is playing for",myDur/second,"seconds">>>;
  myDur => now;
  <<<"a childClip2 stopped at time",(now-t0)/second>>>;
}

</div></pre>

<p>
<input id="startButton" type="button" value="Start" /> 
<input id="stopButton" type="button" value="Stop" /> <br/><br/>
</p>

<script>
    async function prep() {
        //await preloadFilenames( serverFilesToPreload );
        await startChuck();
        await theChuckReady;
        theChuck.removeLastCode();
    }

var editor1 = newChuckEditor("editor1");
var editor2 = newChuckEditor("editor2");
editor2.setOptions({
  showLineNumbers: false
  , showGutter: false
});

var prependCode = `//  none needed
`;

var startButton = document.getElementById( "startButton" );
var stopButton = document.getElementById( "stopButton" );
stopButton.disabled = true;
startButton.style.height = '60px';
startButton.style.width= '120px';
stopButton.style.height = '60px';
stopButton.style.width= '120px';

startButton.addEventListener( "click", async function() {
  await prep();
  await theChuck.runCode(prependCode+editor1.getValue());
  stopButton.disabled = false;
  startButton.value = "Replace";
  await new Promise(r => setTimeout(r, 100));
//  getCsvDataLengthThenData(dataURL, dataFilter);
});

stopButton.addEventListener( "click", async function() {
  await theChuck.removeLastCode();
});
</script>
